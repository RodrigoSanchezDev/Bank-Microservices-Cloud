# Bank Microservices Cloud

> Sistema bancario distribuido de alto rendimiento construido con arquitectura de microservicios

[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.0-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![Spring Cloud](https://img.shields.io/badge/Spring%20Cloud-2024.0.0-blue.svg)](https://spring.io/projects/spring-cloud)
[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://openjdk.org/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)](https://www.docker.com/)
[![Resilience4j](https://img.shields.io/badge/Resilience4j-2.x-green.svg)](https://resilience4j.readme.io/)

---

## ‚ùì Preguntas Frecuentes (FAQ)

<details>
<summary><strong>¬øPor qu√© usar microservicios en lugar de un monolito?</strong></summary>

**Ventajas**:

- **Escalabilidad independiente**: Escala solo los servicios que lo necesitan
- **Despliegue independiente**: Actualiza sin afectar todo el sistema
- **Tecnolog√≠a heterog√©nea**: Usa el stack m√°s adecuado para cada servicio
- **Resiliencia**: Fallas aisladas, no colapsa todo el sistema
- **Equipos aut√≥nomos**: Desarrollo y despliegue descentralizado

**Desventajas**:

- Mayor complejidad operacional
- Necesidad de herramientas de orquestaci√≥n (Docker, Kubernetes)
- Debugging distribuido m√°s complejo

</details>

<details>
<summary><strong>¬øC√≥mo funciona el Circuit Breaker?</strong></summary>

El **Circuit Breaker** monitorea las peticiones a servicios externos:

1. **CLOSED** (Estado Normal):

   - Todas las peticiones pasan normalmente
   - Registra √©xitos y fallos

2. **OPEN** (Servicio Ca√≠do):

   - Se alcanza el umbral de fallos (50% en 10 peticiones)
   - Peticiones fallan inmediatamente sin llamar al servicio
   - Espera 10 segundos antes de intentar recuperaci√≥n

3. **HALF_OPEN** (Prueba de Recuperaci√≥n):
   - Permite 3 peticiones de prueba
   - Si tienen √©xito ‚Üí CLOSED
   - Si fallan ‚Üí OPEN

**Beneficio**: Evita sobrecargar servicios ca√≠dos y falla r√°pidamente

</details>

<details>
<summary><strong>¬øEs necesario usar Docker?</strong></summary>

**No es obligatorio**, pero es altamente recomendado:

**Sin Docker**:

```bash
# Iniciar cada servicio manualmente
cd config-server && mvn spring-boot:run
cd eureka-server && mvn spring-boot:run
cd account-service && mvn spring-boot:run
```

**Con Docker**:

```bash
# Un solo comando
docker-compose up -d
```

**Ventajas de Docker**:

- Entorno consistente (desarrollo = producci√≥n)
- Networking autom√°tico entre servicios
- Gesti√≥n de dependencias (PostgreSQL, Redis)
- Escalabilidad horizontal simple

</details>

<details>
<summary><strong>¬øC√≥mo agrego un nuevo microservicio?</strong></summary>

**Paso 1**: Crear el m√≥dulo Maven

```bash
cd bank-microservices-cloud
mkdir customer-service
cd customer-service
# Copiar estructura de account-service
```

**Paso 2**: Configurar `pom.xml`

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-config</artifactId>
    </dependency>
</dependencies>
```

**Paso 3**: Crear configuraci√≥n en Config Server

```yaml
# config-server/src/main/resources/config-repo/customer-service.yml
spring:
  application:
    name: customer-service
server:
  port: 8082
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
```

**Paso 4**: Registrar en Eureka

```java
@SpringBootApplication
@EnableDiscoveryClient
public class CustomerServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(CustomerServiceApplication.class, args);
    }
}
```

**Paso 5**: Agregar a Docker Compose

```yaml
customer-service:
  build: ./customer-service
  ports:
    - "8082:8082"
  depends_on:
    - config-server
    - eureka-server
```

</details>

<details>
<summary><strong>¬øC√≥mo funciona la autenticaci√≥n JWT?</strong></summary>

**Flujo de Autenticaci√≥n**:

1. **Login**:

   ```bash
   POST /api/auth/login
   Body: { "username": "user1", "password": "password123" }
   ```

2. **Respuesta con Token**:

   ```json
   {
     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "expiresAt": "2024-12-31T23:59:59Z"
   }
   ```

3. **Uso del Token**:
   ```bash
   GET /api/accounts
   Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

**Componentes**:

- `JwtTokenProvider`: Genera y valida tokens
- `JwtAuthenticationFilter`: Intercepta peticiones y valida tokens
- `SecurityConfig`: Define rutas protegidas

**Expiraci√≥n**: Tokens v√°lidos por 24 horas

</details>

<details>
<summary><strong>¬øQu√© hacer si Eureka no muestra los servicios?</strong></summary>

**Checklist de Diagn√≥stico**:

1. **Verificar que Eureka est√© corriendo**:

   ```bash
   curl http://localhost:8761
   # Debe retornar la UI de Eureka
   ```

2. **Revisar logs del servicio**:

   ```bash
   docker logs account-service
   # Buscar: "DiscoveryClient_ACCOUNT-SERVICE"
   ```

3. **Verificar configuraci√≥n**:

   ```yaml
   eureka:
     client:
       service-url:
         defaultZone: http://eureka-server:8761/eureka/
       fetch-registry: true
       register-with-eureka: true
   ```

4. **Esperar el registro**:

   - Los servicios tardan ~30 segundos en aparecer
   - Eureka tiene un mecanismo de cach√©

5. **Revisar networking (Docker)**:
   ```bash
   docker network inspect bank-microservices-cloud_default
   # Verificar que todos los servicios est√©n en la misma red
   ```

</details>

---

## üó∫Ô∏è Roadmap

### üìå v1.0.0 - Sistema Base (Actual)

- ‚úÖ Arquitectura de Microservicios
- ‚úÖ Config Server (Centralizado)
- ‚úÖ Eureka Discovery Service
- ‚úÖ Account Service (CRUD + CSV Migration)
- ‚úÖ Patrones de Resiliencia (Resilience4j)
- ‚úÖ Autenticaci√≥n JWT
- ‚úÖ Containerizaci√≥n Docker
- ‚úÖ Spring Boot 3.5.0
- ‚úÖ Spring Cloud 2024.0.0
- ‚úÖ Java 21

### üöÄ v1.1.0 - Mejoras de Infraestructura (Pr√≥ximo)

- üîÑ **API Gateway (Spring Cloud Gateway)**

  - Enrutamiento centralizado
  - Rate limiting global
  - Autenticaci√≥n unificada

- üîÑ **Tracing Distribuido**

  - Micrometer Tracing
  - Zipkin para visualizaci√≥n
  - Correlaci√≥n de requests entre servicios

- üîÑ **Monitoreo Avanzado**

  - Prometheus para m√©tricas
  - Grafana dashboards
  - Alertas automatizadas

- üîÑ **Cach√© Distribuido**

  - Redis para sesiones
  - Cach√© de consultas frecuentes

- üîÑ **Mensajer√≠a As√≠ncrona**
  - Apache Kafka / RabbitMQ
  - Event-driven architecture
  - SAGA Pattern para transacciones distribuidas

### üåü v2.0.0 - Escalabilidad y Cloud Native (Futuro)

- ‚è≥ **Programaci√≥n Reactiva**

  - Spring WebFlux
  - Non-blocking I/O
  - Backpressure handling

- ‚è≥ **API GraphQL**

  - Consultas flexibles
  - Reducci√≥n de overfetching

- ‚è≥ **SAGA Pattern**

  - Transacciones distribuidas
  - Compensaci√≥n autom√°tica

- ‚è≥ **Service Mesh**

  - Istio / Linkerd
  - mTLS autom√°tico
  - Observabilidad avanzada

- ‚è≥ **Kubernetes**

  - Orquestaci√≥n de contenedores
  - Auto-scaling
  - Self-healing

- ‚è≥ **CI/CD**
  - GitHub Actions / GitLab CI
  - Despliegue automatizado
  - Tests de integraci√≥n

---

## üìö Recursos y Referencias

### Documentaci√≥n Oficial

- [Spring Boot 3.5.x Documentation](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)
- [Spring Cloud 2024.0.x Documentation](https://docs.spring.io/spring-cloud/docs/current/reference/html/)
- [Resilience4j Official Guide](https://resilience4j.readme.io/)
- [Netflix Eureka Wiki](https://github.com/Netflix/eureka/wiki)

### Art√≠culos Recomendados

- [Microservices Patterns - Chris Richardson](https://microservices.io/patterns/index.html)
- [The Twelve-Factor App](https://12factor.net/)
- [Circuit Breaker Pattern - Martin Fowler](https://martinfowler.com/bliki/CircuitBreaker.html)
- [SAGA Pattern Explained](https://microservices.io/patterns/data/saga.html)

### Tutoriales

- [Spring Cloud Netflix Eureka Tutorial](https://spring.io/guides/gs/service-registration-and-discovery/)
- [Resilience4j with Spring Boot](https://resilience4j.readme.io/docs/getting-started-3)
- [Docker Compose for Microservices](https://docs.docker.com/compose/gettingstarted/)

---

## üìë Tabla de Contenidos

- [Descripci√≥n](#-descripci√≥n)
- [Arquitectura](#Ô∏è-arquitectura)
- [Componentes](#-componentes)
- [Modelo de Datos](#-modelo-de-datos)
- [Stack Tecnol√≥gico](#Ô∏è-stack-tecnol√≥gico)
- [Inicio R√°pido](#-inicio-r√°pido)
- [Seguridad](#-seguridad)
- [Patrones de Resiliencia](#Ô∏è-patrones-de-resiliencia)
- [Testing y Calidad](#-testing-y-calidad)
- [Monitoreo y Observabilidad](#-monitoreo-y-observabilidad)
- [Preguntas Frecuentes (FAQ)](#-preguntas-frecuentes-faq)
- [Roadmap](#Ô∏è-roadmap)
- [Recursos y Referencias](#-recursos-y-referencias)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Patrones Implementados](#-patrones-implementados)
- [Despliegue en Producci√≥n](#-despliegue-en-producci√≥n)
- [Contribuciones](#-contribuciones)
- [Contacto](#-contacto)
- [Licencia](#-licencia)

---

## üìã Descripci√≥n

Plataforma empresarial de microservicios para gesti√≥n bancaria que implementa patrones avanzados de resiliencia, configuraci√≥n centralizada, descubrimiento de servicios y seguridad distribuida mediante Spring Cloud y Resilience4j.

### Caracter√≠sticas Principales

- ‚úÖ **Arquitectura de Microservicios** escalable y distribuida
- ‚úÖ **Configuraci√≥n Centralizada** con Spring Cloud Config
- ‚úÖ **Service Discovery** con Netflix Eureka
- ‚úÖ **Autenticaci√≥n JWT** y seguridad distribuida
- ‚úÖ **Patrones de Resiliencia** (Circuit Breaker, Retry, Rate Limiting)
- ‚úÖ **Contenedorizaci√≥n** con Docker
- ‚úÖ **API RESTful** documentada con Swagger/OpenAPI
- ‚úÖ **Monitoreo** con Spring Actuator

---

## üèóÔ∏è Arquitectura

### Diagrama de Componentes

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              API Gateway (8080)                          ‚îÇ
‚îÇ         Autenticaci√≥n JWT + Enrutamiento                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ               ‚îÇ               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇConfig Server ‚îÇ ‚îÇ   Eureka   ‚îÇ ‚îÇ  Account   ‚îÇ
‚îÇ   (8888)     ‚îÇ ‚îÇ   Server   ‚îÇ ‚îÇ  Service   ‚îÇ
‚îÇ              ‚îÇ ‚îÇ   (8761)   ‚îÇ ‚îÇ   (8081)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                       ‚îÇ
                                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                ‚îÇ PostgreSQL  ‚îÇ
                                ‚îÇ   (5432)    ‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Principios Arquitect√≥nicos

- **Independencia de Servicios**: Cada microservicio puede desplegarse independientemente
- **Configuraci√≥n Externalizada**: Configuraciones centralizadas en Config Server
- **Descubrimiento Din√°mico**: Registro autom√°tico de servicios en Eureka
- **Resiliencia**: Implementaci√≥n de Circuit Breaker, Retry y Rate Limiting
- **Seguridad Distribuida**: Autenticaci√≥n JWT en cada microservicio

---

## üöÄ Componentes

### Config Server (Puerto 8888)

**Servidor de configuraci√≥n centralizada**

- Gestiona configuraciones de todos los microservicios
- Soporte para perfiles de ambiente (dev, prod)
- Actualizaci√≥n de configuraci√≥n en tiempo real

### Eureka Server (Puerto 8761)

**Service Discovery y Service Registry**

- Registro autom√°tico de microservicios
- Dashboard web para monitoreo
- Detecci√≥n de servicios ca√≠dos (heartbeat)
- Balanceo de carga del lado del cliente

### Account Service (Puerto 8081)

**Microservicio de gesti√≥n bancaria**

**Caracter√≠sticas**:

- API RESTful para operaciones CRUD de cuentas
- Procesamiento de datos legacy del sistema bancario
- Autenticaci√≥n y autorizaci√≥n JWT
- Integraci√≥n con PostgreSQL mediante JPA
- Documentaci√≥n Swagger/OpenAPI
- M√©tricas y health checks con Actuator

**Patrones de Resiliencia**:

- Circuit Breaker (protecci√≥n contra fallos en cascada)
- Retry (reintentos autom√°ticos)
- Rate Limiter (control de tr√°fico: 10 req/min)
- Time Limiter (timeout en operaciones)

### API Gateway (Puerto 8080)

**Punto de entrada unificado** _(Opcional - Recomendado para producci√≥n)_

- Enrutamiento inteligente de peticiones
- Autenticaci√≥n centralizada
- Rate limiting global
- Logging y monitoreo centralizado

---

## üìä Modelo de Datos

### Entidades Principales

**Cuentas Bancarias** (`accounts`)

- Gesti√≥n completa de cuentas
- Tipos: Ahorros, Corriente, N√≥mina
- Control de saldos y estados

**Transacciones** (`transactions`)

- Registro de movimientos financieros
- Tipos: Dep√≥sito, Retiro, Transferencia
- Validaci√≥n de reglas de negocio

**Intereses** (`interests`)

- C√°lculo autom√°tico de intereses
- Aplicaci√≥n mensual seg√∫n tipo de cuenta
- Historial de aplicaciones

**Usuarios** (`users`)

- Autenticaci√≥n y autorizaci√≥n
- Roles: ADMIN, USER
- Gesti√≥n de credenciales JWT

### Referencia de Datos Legacy

Basado en el dataset [bank_legacy_data](https://github.com/KariVillagran/bank_legacy_data) para procesamiento de informaci√≥n hist√≥rica.

---

## üõ†Ô∏è Stack Tecnol√≥gico

| Tecnolog√≠a      | Versi√≥n  | Prop√≥sito                   |
| --------------- | -------- | --------------------------- |
| Java            | 21       | Lenguaje de programaci√≥n    |
| Spring Boot     | 3.5.0    | Framework de aplicaci√≥n     |
| Spring Cloud    | 2024.0.0 | Framework de microservicios |
| Spring Security | 6.x      | Seguridad y autenticaci√≥n   |
| Resilience4j    | 2.x      | Patrones de resiliencia     |
| PostgreSQL      | 15+      | Base de datos relacional    |
| Docker          | Latest   | Contenedorizaci√≥n           |
| Maven           | 3.8+     | Gesti√≥n de dependencias     |
| Lombok          | 1.18.34  | Reducci√≥n de boilerplate    |

---

## üöÄ Inicio R√°pido

### Requisitos Previos

- **JDK**: 21 o superior
- **Maven**: 3.8 o superior
- **Docker**: 20.10 o superior
- **Docker Compose**: 2.0 o superior

### Instalaci√≥n

#### Opci√≥n 1: Docker Compose (Recomendado)

```bash
# Clonar el repositorio
git clone https://github.com/RodrigoSanchezDev/bank-microservices-cloud.git
cd bank-microservices-cloud

# Construir y levantar todos los servicios
docker-compose up -d

# Verificar estado
docker-compose ps

# Ver logs
docker-compose logs -f

# Detener servicios
docker-compose down
```

#### Opci√≥n 2: Ejecuci√≥n Local

```bash
# 1. Compilar
mvn clean install -DskipTests

# 2. Iniciar Config Server (Terminal 1)
cd config-server && mvn spring-boot:run

# 3. Iniciar Eureka Server (Terminal 2)
cd eureka-server && mvn spring-boot:run

# 4. Iniciar Account Service (Terminal 3)
cd account-service && mvn spring-boot:run
```

### Verificaci√≥n

Espera ~60 segundos para que los servicios se registren.

- **Config Server**: http://localhost:8888/actuator/health
- **Eureka Dashboard**: http://localhost:8761
- **Account Service**: http://localhost:8081/actuator/health
- **Swagger UI**: http://localhost:8081/swagger-ui.html

---

## üìç Endpoints Principales

### Eureka Dashboard

```
http://localhost:8761
```

### Config Server

```
http://localhost:8888/account-service/default
```

### Account Service API

**Autenticaci√≥n (Obtener JWT)**

```bash
POST http://localhost:8081/api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

### Operaciones de Cuentas (requiere JWT)

```bash
# Listar cuentas
GET http://localhost:8081/api/accounts
Authorization: Bearer {token}

# Crear cuenta
POST http://localhost:8081/api/accounts
Authorization: Bearer {token}
Content-Type: application/json

{
  "accountNumber": "1234567890",
  "accountHolder": "Juan P√©rez",
  "balance": 1000.00,
  "accountType": "SAVINGS"
}

# Obtener cuenta por ID
GET http://localhost:8081/api/accounts/{id}
Authorization: Bearer {token}
```

### Health & Monitoreo

```bash
# Health check
GET http://localhost:8081/actuator/health

# Circuit Breaker estado
GET http://localhost:8081/actuator/health/circuitbreakers

# M√©tricas
GET http://localhost:8081/actuator/metrics
```

---

## üîí Seguridad

### Autenticaci√≥n JWT

**Configuraci√≥n**:

- Algoritmo: HS512
- Tiempo de vida: 24 horas
- Claims: username, roles, authorities

**Credenciales por Defecto**:

- Username: `admin`
- Password: `admin123`
- Rol: `ADMIN`

‚ö†Ô∏è **Importante**: Cambia las credenciales en producci√≥n y utiliza variables de entorno.

### Endpoints Protegidos

- ‚úÖ Todos los endpoints bajo `/api/accounts` requieren autenticaci√≥n
- ‚úÖ Endpoints administrativos requieren rol `ADMIN`
- ‚úÖ Endpoints de lectura disponibles para rol `USER`
- ‚ùå Endpoints p√∫blicos: `/api/auth/login`, `/actuator/health`

---

## üõ°Ô∏è Patrones de Resiliencia

### Circuit Breaker (Resilience4j)

**Configuraci√≥n**:

```yaml
slidingWindowSize: 10
failureRateThreshold: 50
waitDurationInOpenState: 10s
permittedNumberOfCallsInHalfOpenState: 3
```

**Estados**:

- **CLOSED**: Operaci√≥n normal, todas las peticiones pasan
- **OPEN**: Umbral alcanzado, peticiones fallan r√°pidamente
- **HALF_OPEN**: Prueba si el servicio se recuper√≥

### Retry Pattern

**Configuraci√≥n**:

```yaml
maxAttempts: 3
waitDuration: 2s
retryExceptions:
  - java.io.IOException
  - java.util.concurrent.TimeoutException
```

**Estrategia**: Exponential backoff con jitter

### Rate Limiter

**Configuraci√≥n**:

```yaml
limitForPeriod: 10
limitRefreshPeriod: 1m
timeoutDuration: 0
```

**Protecci√≥n**: L√≠mite de 10 peticiones por minuto por endpoint

### Time Limiter

**Configuraci√≥n**:

```yaml
timeoutDuration: 5s
cancelRunningFuture: true
```

**Objetivo**: Prevenir operaciones de larga duraci√≥n

---

## üß™ Testing y Calidad

```bash
# Ejecutar tests
mvn clean test

# Tests de un m√≥dulo
cd account-service && mvn test

# Reporte de cobertura
mvn clean test jacoco:report
```

### Colecci√≥n Postman

Importa `postman-collection.json` para probar todos los endpoints.

---

## üìä Monitoreo y Observabilidad

### Spring Actuator

```bash
# Health check
curl http://localhost:8081/actuator/health

# M√©tricas
curl http://localhost:8081/actuator/metrics

# Info
curl http://localhost:8081/actuator/info
```

---

## üìÅ Estructura del Proyecto

```
bank-microservices-cloud/
‚îú‚îÄ‚îÄ config-server/              # Configuraci√≥n centralizada
‚îú‚îÄ‚îÄ eureka-server/              # Service Discovery
‚îú‚îÄ‚îÄ account-service/            # Microservicio de cuentas
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/duoc/bank/account/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ config/         # Configuraci√≥n
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ controller/     # REST Controllers
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dto/            # Data Transfer Objects
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ model/          # Entidades JPA
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ repository/     # Repositorios
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ security/       # JWT Security
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ service/        # L√≥gica de negocio
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/
‚îÇ       ‚îú‚îÄ‚îÄ application.yml
‚îÇ       ‚îî‚îÄ‚îÄ data/               # Datos legacy CSV
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ pom.xml
‚îú‚îÄ‚îÄ LICENSE
‚îî‚îÄ‚îÄ README.md
```

---

## üìù Patrones Implementados

- ‚úÖ Configuraci√≥n Centralizada (Spring Cloud Config)
- ‚úÖ Service Discovery (Netflix Eureka)
- ‚úÖ Circuit Breaker (Resilience4j)
- ‚úÖ Retry Pattern (Resilience4j)
- ‚úÖ Rate Limiting (Resilience4j)
- ‚úÖ Time Limiter (Resilience4j)
- ‚úÖ Authentication & Authorization (Spring Security + JWT)
- ‚úÖ API Gateway Pattern (Routing centralizado)

---

## üöÄ Despliegue en Producci√≥n

### Variables de Entorno

**Config Server**:

```bash
SPRING_PROFILES_ACTIVE=prod
CONFIG_GIT_URI=https://github.com/your-org/config-repo.git
CONFIG_GIT_USERNAME=your-username
CONFIG_GIT_PASSWORD=your-token
```

**Eureka Server**:

```bash
SPRING_PROFILES_ACTIVE=prod
EUREKA_INSTANCE_HOSTNAME=eureka-prod.yourdomain.com
EUREKA_CLIENT_REGISTER_WITH_EUREKA=false
```

**Account Service**:

```bash
SPRING_PROFILES_ACTIVE=prod
SPRING_DATASOURCE_URL=jdbc:postgresql://prod-db.yourdomain.com:5432/bankdb
SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
JWT_SECRET=${JWT_SECRET_KEY}
EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-prod.yourdomain.com:8761/eureka/
```

### Checklist Pre-Producci√≥n

**Seguridad**:

- [ ] Cambiar credenciales por defecto (admin/admin123)
- [ ] Configurar JWT secret fuerte (m√≠nimo 256 bits)
- [ ] Habilitar HTTPS/TLS en todos los servicios
- [ ] Configurar CORS apropiadamente
- [ ] Revisar roles y permisos de usuarios
- [ ] Implementar rate limiting agresivo

**Base de Datos**:

- [ ] Backups autom√°ticos configurados
- [ ] √çndices en columnas de b√∫squeda frecuente
- [ ] Pools de conexiones optimizados
- [ ] Logging de queries lentas activado

**Configuraci√≥n**:

- [ ] Profiles de producci√≥n activados
- [ ] Timeouts configurados apropiadamente
- [ ] Circuit breaker thresholds ajustados
- [ ] Retry strategies validadas

**Monitoreo**:

- [ ] Actuator endpoints asegurados
- [ ] APM configurado (New Relic, Datadog, etc.)
- [ ] Logging centralizado (ELK, Splunk)
- [ ] Alertas configuradas (PagerDuty, Slack)

**Infraestructura**:

- [ ] Auto-scaling configurado
- [ ] Load balancers en lugar
- [ ] Health checks configurados
- [ ] Disaster recovery plan documentado

### Docker en Producci√≥n

**Optimizaci√≥n de Im√°genes**:

```dockerfile
# Multi-stage build para reducir tama√±o
FROM eclipse-temurin:21-jdk-alpine AS builder
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -DskipTests

FROM eclipse-temurin:21-jre-alpine
WORKDIR /app
COPY --from=builder /app/target/*.jar app.jar
EXPOSE 8081
ENTRYPOINT ["java", "-Xmx512m", "-Xms256m", "-jar", "app.jar"]
```

**Docker Compose Production**:

```yaml
services:
  account-service:
    image: registry.yourdomain.com/account-service:1.0.0
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - JAVA_OPTS=-Xmx1g -Xms512m
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: "1"
          memory: 1G
        reservations:
          cpus: "0.5"
          memory: 512M
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### Escalado Horizontal

**Docker Compose Scale**:

```bash
# Escalar Account Service a 3 instancias
docker-compose up -d --scale account-service=3
```

**Kubernetes (futuro)**:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: account-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: account-service
  template:
    metadata:
      labels:
        app: account-service
    spec:
      containers:
        - name: account-service
          image: account-service:1.0.0
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "1Gi"
              cpu: "1000m"
```

---

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor:

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

---

## üìß Contacto

**Rodrigo Sanchez**

- Email: [rodrigo@sanchezdev.com](mailto:rodrigo@sanchezdev.com)
- Website: [sanchezdev.com](https://sanchezdev.com)
- GitHub: [@RodrigoSanchezDev](https://github.com/RodrigoSanchezDev)

---

## üìÑ Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.

---

<div align="center">

**Desarrollado por [Rodrigo Sanchez](https://sanchezdev.com)**

Copyright ¬© 2025 Rodrigo Sanchez. Todos los derechos reservados.

</div>
